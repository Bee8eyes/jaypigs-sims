# Jaypigs_marketplace_sim
This document details everything about simulating Jaypigs model of fee distribution on the users.

The simulation code contains two scripts: **variables.py** and **sim_test.py**.

**variables.py** contains the variables used for the simulation.  
**sim_test.py** contains the code that runs the simulation based on the model explained below.

To simply run the simulations with the pre-set variables, pull the repository both scripts and execute **sim_test.py**.  
To run the simulation with customized variables you can change variables.py, save it, then execute **sim_test.py**.
 
##  Revenue Distribution model

Jaypigs distributs the fees revenue distribution model theory is explained here :
[Jaypigs Distribution model](https://www.dropbox.com/s/4ypm2dvgnixfn0x/Jaypigs%20Revenue%20Sharing%20Model_v1.2.pdf?dl=0).

## Simulation results
The event simulated below corresponds to 5 users making sales on random blocks.
### Prequisites:  

The simulation is made on the next assumptions:
- **Sale Volume**: All sales have the same volume. For this simulation V=1 Avax.
- **Number of users**: It's fixed at 5 user. Each user makes a different number of transactions at random blocks. The number of transactions Users 1 to 5 made is respectively, 1,3,5,10,15 sales. 
- **Total duration**:  The total duration of the simulation is 100 blocks. The scale can be considered 1/100, so block Number N in the simulation refers to the block N*100 in real scale. 
- **Decay factor**: The Decay factor ```τ``` , determines how rapidly, the significance of a user's generated volume in a certain sale, decreases over time. More details about ```τ``` can be found in the [Decay factor impact](#Decay-factor-impact) section below. 
- **fee**: This is the fee the platform collects from each sale. It's set at 10% for the current simulation. 



The current simulation contains three metrics that allow us to globally evaluate the performance of the platform, and how the fees are distributed  over time.
### Results  
#### 1. **Total Weighted volume per user over time.**  
In order to compute a user's share in the total fee pool, we need to compute the total volume a user owns, at any point of time, aka at all blocks.


We convert the generated volume per sale to the **weighted volume**, by multiplying the volume generated (by a certain sale, for a certain user) with a descending exponential function over time.    
The total **weighted volume** (WV) is simply the sum of all the **weighted volumes** the sales of a certain user have generated. As a result, The sum of weighted volumes represents to a greater extent, the recent volume that a user have generated. That is due to the fact that older the volume, the smaller it's corresponding WV.   
More details about the theory can be found in [Jaypigs Distribution model](https://www.dropbox.com/s/4ypm2dvgnixfn0x/Jaypigs%20Revenue%20Sharing%20Model_v1.2.pdf?dl=0).

WV Simulation result:
![Total Weighted volume evolution per user](https://github.com/Bee8eyes/jaypigs-sims/blob/main/Weighted%20Volume.PNG)   
 
**Analysis:** for a certain user, the spikes corresponds to the moment that user made a sale. This volume decreases over time if the user do not make any recent purchase. (Again, because every volume unit generated by a sale, declines over time, so the sum of all volumes also declines).  

If a user wants to keep his total weighted volume high over time he needs to constantly make sales, so each sale gives a boost to his total volume.

In the long run, the user with most consistent sale rate (The user that keeps generating volume for consecutive periods of time) ends up winning the race to the highest weighted volume, thus pool share.
  
#### 2. Pool share percentage of the fees per user over time.

The pool share percentage or PSP, represents the share of the user in the fee pool, by block. It varies over time due to the different sales users make. Users with most frequent recent sales before a certain block, will have a higher PSP than others for that block.  

PSP Simulation result: 
![Pool share evolution per user](https://github.com/Bee8eyes/jaypigs-sims/blob/main/PSP.PNG)

**Analysis:** At block 1, user 3 had 100% of the pool share so he gets 100% of the fee the user after him generated. But after few block, other users made few sales so the ones that did that, have now a share in the fee pool. 

One user PSP is not impacted only by his own volume, but also the volume of other users. 


#### 3. Balance per user over time.

The balance represents how much fees were redistributed to each user at any point of time.  

Balance Simulation result:
![Balance evolution per user](https://github.com/Bee8eyes/jaypigs-sims/blob/main/Balance.PNG)  

**Analysis:** The balance chart is explicit. The revenues generated by the platform (for every sale) are distributed according to the pool share percentage for each user. Once a transaction has been made. All users receive a portion of the fee. Each time there's a raise in users balance, it means that in that specific block a sale has been made by one of them.

## Decay factor impact
```τ``` controls the descent rate of the weighted volume. The bigger ```τ``` is the slower the descent and vice versa. If ```τ``` is too low then only the very recent volumes are taken into account to calculate the user share of the pool. If ```τ``` is too high the rate of descent is so slow to the point it becomes almost constant(it will eventually go to 0, but that will take much longer).

Here are two examples:

```τ=10000```:  
![Big tau](https://github.com/Bee8eyes/jaypigs-sims/blob/main/big_tau.PNG)  

```τ=0.5``` :  
![small tau](https://github.com/Bee8eyes/jaypigs-sims/blob/main/small_tau.PNG) 

The Impact on the final balance of the users is insignificant. The weighted volumes for all users decay at the same rate so it kind of cancels out (same decrease applied to everyone).
The Impact can be seen within someone who makes successive sales for a certain period of time will eventually keep win of the fees because the volumes of other users is decreasing rapidly unless they constantly make sales. 

Conclusion: The decay factor should be determined based on how rapidly we want the volumes significance to decrease. In the future, this variable will be dynamic based on the number of the users on the platform, and will be studied more in depth.
